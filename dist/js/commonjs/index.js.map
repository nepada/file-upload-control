{"version":3,"file":"index.js","sources":["../../../src/assets/js/index.js"],"sourcesContent":["import $ from 'jquery';\nimport 'blueimp-file-upload';\nimport {Buttons, FilesList, FileUpload} from './ui';\n\n\nfunction initializeControl(container) {\n    const $fileUpload = $(container);\n    if ($fileUpload.data('blueimpFileupload')) {\n        return;\n    }\n\n    const uniqueFilenames = {};\n    ($fileUpload.data('uniqueFilenames') || []).forEach((filename) => {\n        uniqueFilenames[filename] = true;\n    });\n\n    $fileUpload.fileupload({\n        url: $fileUpload.data('fileUploadUrl'),\n        dropZone: $fileUpload,\n        pasteZone: null,\n        dataType: 'json',\n        formData: [], // do not send other form data with file uploads\n        uniqueFilenames,\n        singleFileUploads: true,\n        maxChunkSize: 2 * 1024 * 1024,\n        limitConcurrentUploads: 3,\n        submit: () => {\n            return !$fileUpload.hasClass('disabled') && !$fileUpload.is(':disabled') && !$fileUpload.find('input[type=file]').prop('disabled');\n        },\n    });\n\n    const filesList = new FilesList($fileUpload);\n    const buttons = new Buttons($fileUpload);\n\n    // eslint-disable-next-line consistent-return\n    $fileUpload.on('fileuploadadd', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload = new FileUpload($fileUpload, data.files);\n        data.fileUpload.$file.data('upload', data);\n        buttons.refreshState();\n\n    // eslint-disable-next-line consistent-return\n    }).on('fileuploadprogress', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload.updateProgress(data.loaded / data.total);\n\n    }).on('fileuploadfail', (e, data) => {\n        if (!data.fileUpload) {\n            return;\n        }\n        if (data.errorThrown === 'abort') {\n            data.fileUpload.aborted();\n        } else {\n            data.fileUpload.failed();\n            buttons.refreshState();\n        }\n\n    }).on('fileuploaddone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n        } else {\n            data.fileUpload.done(file);\n        }\n        buttons.refreshState();\n\n    }).on('fileuploadchunkdone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n            buttons.refreshState();\n        } else {\n            data.fileUpload.processing(file);\n        }\n\n    }).on('fileuploadchunksend', (e, data) => {\n        return !data.fileUpload || data.fileUpload.status !== 'failed';\n\n    }).on('click', '[data-file-upload-role=file-delete]', function () {\n        const $this = $(this);\n        const $file = $this.closest('[data-file-upload-role=file]');\n        const upload = $file.data('upload');\n        if (upload) {\n            upload.abort();\n        }\n        const deleteUrl = $this.data('url');\n        if (deleteUrl) {\n            $.get(deleteUrl);\n            filesList.removeByDeleteUrl(deleteUrl);\n        }\n        $file.fadeOut(() => {\n            $file.remove();\n            buttons.refreshState();\n        });\n\n    });\n}\n\n\nfunction initializeForm(form) {\n    $(form)\n        .find('[data-file-upload-url]')\n        .each((idx, container) => {\n            initializeControl(container);\n        });\n}\n\n\nfunction initializeFileUploadControl(Nette) {\n    // Disable default browser drop event\n    $(document).on('drop dragover', (e) => {\n        e.preventDefault();\n    });\n\n    // Validation\n    Nette.validators.NepadaFileUploadControlValidationClientSide_noUploadInProgress = (element) => {\n        return $(element).closest('[data-file-upload-url]').find('[data-file-upload-status=processing] [data-file-upload-role=file-delete]').length === 0;\n    };\n\n    // Effective value\n    const originalGetEffectiveValue = Nette.getEffectiveValue;\n    Nette.getEffectiveValue = (elem, filter) => {\n        if (!elem || !elem.nodeName || elem.nodeName.toLowerCase() !== 'input' || !$(elem).data('files')) {\n            return originalGetEffectiveValue.apply(Nette, [elem, filter]);\n        }\n        return $(elem).data('files');\n    };\n\n    // Initialize all forms on document ready\n    $(() => {\n        $('form').each((idx, form) => {\n            initializeForm(form);\n        });\n    });\n\n    // Tap into Nette.initForm() to provide AJAX snippet support via e.g. Naja\n    const originalInitForm = Nette.initForm;\n    Nette.initForm = (form) => {\n        originalInitForm.apply(Nette, [form]);\n        initializeForm(form);\n    };\n}\n\n\nexport default initializeFileUploadControl;\n"],"names":[],"mappings":"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"}
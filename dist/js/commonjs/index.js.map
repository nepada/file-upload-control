{"version":3,"file":"index.js","sources":["../../../src/assets/js/index.js"],"sourcesContent":["import $ from 'jquery';\nimport 'blueimp-file-upload';\nimport {Buttons, FilesList, FileUpload} from './ui';\n\n\nfunction initializeControl(container) {\n    const $fileUpload = $(container);\n    if ($fileUpload.data('blueimpFileupload')) {\n        return;\n    }\n\n    const uniqueFilenames = {};\n    ($fileUpload.data('uniqueFilenames') || []).forEach((filename) => {\n        uniqueFilenames[filename] = true;\n    });\n\n    $fileUpload.fileupload({\n        url: $fileUpload.data('fileUploadUrl'),\n        dropZone: $fileUpload,\n        pasteZone: null,\n        dataType: 'json',\n        formData: [], // do not send other form data with file uploads\n        uniqueFilenames,\n        singleFileUploads: true,\n        maxChunkSize: 2 * 1024 * 1024,\n        limitConcurrentUploads: 3,\n        submit: () => {\n            return !$fileUpload.hasClass('disabled') && !$fileUpload.is(':disabled') && !$fileUpload.find('input[type=file]').prop('disabled');\n        },\n    });\n\n    const filesList = new FilesList($fileUpload);\n    const buttons = new Buttons($fileUpload);\n\n    // eslint-disable-next-line consistent-return\n    $fileUpload.on('fileuploadadd', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload = new FileUpload($fileUpload, data.files);\n        data.fileUpload.$file.data('upload', data);\n        buttons.refreshState();\n\n    // eslint-disable-next-line consistent-return\n    }).on('fileuploadprogress', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload.updateProgress(data.loaded / data.total);\n\n    }).on('fileuploadfail', (e, data) => {\n        if (data.fileUpload && data.errorThrown !== 'abort') {\n            data.fileUpload.failed();\n            buttons.refreshState();\n        }\n\n    }).on('fileuploaddone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n        } else {\n            data.fileUpload.done(file);\n            filesList.add(file);\n        }\n        buttons.refreshState();\n\n    }).on('fileuploadchunkdone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n            buttons.refreshState();\n        } else {\n            data.fileUpload.processing(file);\n        }\n\n    }).on('fileuploadchunksend', (e, data) => {\n        return !data.fileUpload || data.fileUpload.status !== 'failed';\n\n    }).on('click', '[data-file-upload-role=file-delete]', function () {\n        const $this = $(this);\n        const $file = $this.closest('[data-file-upload-role=file]');\n        const upload = $file.data('upload');\n        if (upload) {\n            upload.abort();\n        }\n        if ($this.is('[data-url]')) {\n            $.get($this.data('url'));\n        }\n        const fileUrl = $file.find('[data-file-upload-role=file-download]').attr('href');\n        filesList.remove(fileUrl);\n        $file.fadeOut(() => {\n            $file.remove();\n            buttons.refreshState();\n        });\n\n    });\n}\n\n\nfunction initializeForm(form) {\n    $(form)\n        .find('[data-file-upload-url]')\n        .each((idx, container) => {\n            initializeControl(container);\n        });\n}\n\n\nfunction initializeFileUploadControl(Nette) {\n    // Disable default browser drop event\n    $(document).on('drop dragover', (e) => {\n        e.preventDefault();\n    });\n\n    // Effective value\n    const originalGetEffectiveValue = Nette.getEffectiveValue;\n    Nette.getEffectiveValue = (elem, filter) => {\n        if (!elem || !elem.nodeName || elem.nodeName.toLowerCase() !== 'input' || !$(elem).data('files')) {\n            return originalGetEffectiveValue(elem, filter);\n        }\n        return $(elem).data('files');\n    };\n\n    // Initialize all forms on document ready\n    $(() => {\n        $('form').each((idx, form) => {\n            initializeForm(form);\n        });\n    });\n\n    // Tap into Nette.initForm() to provide AJAX snippet support via e.g. Naja\n    const originalInitForm = Nette.initForm;\n    Nette.initForm = (form) => {\n        originalInitForm(form);\n        initializeForm(form);\n    };\n}\n\n\nexport default initializeFileUploadControl;\n"],"names":["$"],"mappings":"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"}
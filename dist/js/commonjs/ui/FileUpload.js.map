{"version":3,"file":"FileUpload.js","sources":["../../../../src/assets/js/ui/FileUpload.js"],"sourcesContent":["import $ from 'jquery';\nimport FilesList from './FilesList';\n\nclass FileUpload {\n\n    constructor($fileUpload, files) {\n        let name = '';\n        let size = 0;\n        let type = '';\n        $.each(files, (index, file) => {\n            name = name + (index ? ', ' : '') + file.name;\n            size = size + file.size;\n            type = type || file.type;\n            if (type !== file.type) {\n                type = type + ', ' + file.type;\n            }\n        });\n\n        this.name = name;\n        this.size = size;\n        this.type = type;\n        this.status = 'processing';\n        this.progress = 0;\n        this.deleteUrl = null;\n        this.downloadUrl = null;\n        this.thumbnailUrl = null;\n        this.error = null;\n        this.$filesContainer = $fileUpload.find('[data-file-upload-role=files]');\n        this.$file = this.createUI();\n\n        const uid = [name, size, Math.floor(Math.random() * 2**32)].join('|');\n        this.fileListItem = {name, size, type, uid};\n        this.fileList = new FilesList($fileUpload);\n        this.fileList.add(this.fileListItem);\n\n        this.updateFileInfoUI();\n        this.$filesContainer.append(this.$file);\n        this.$file.fadeIn();\n    }\n\n    createUI() {\n        const $file = $(this.$filesContainer.data('templateFile'));\n        $file.find('[data-file-upload-role=file-status]').append($(this.$filesContainer.data('templateProcessing')));\n        $file.hide();\n        return $file;\n    }\n\n    updateProgress(progress) {\n        this.progress = Math.max(0, Math.min(progress, 1)) * 100;\n        this.updateFileInfoUI();\n    }\n\n    updateFileInfo(file) {\n        this.downloadUrl = file.url || this.downloadUrl;\n        this.thumbnailUrl = file.thumbnailUrl || this.thumbnailUrl;\n        this.deleteUrl = file.deleteUrl || this.deleteUrl;\n        this.type = file.type || this.type;\n        this.replaceFileListItem(file);\n    }\n\n    replaceFileListItem(file) {\n        if (this.fileListItem) {\n            this.fileList.removeByUid(this.fileListItem.uid);\n            this.fileList.add(file);\n            this.fileListItem = null;\n        }\n    }\n\n    processing(file) {\n        this.updateFileInfo(file);\n        this.updateFileInfoUI();\n    }\n\n    failed(file) {\n        this.status = 'failed';\n        if (file && file.error) {\n            this.error = file.error;\n        }\n        const $error = $(this.$filesContainer.data('templateFailed'));\n        this.updateFileInfoUI($error);\n        this.$file.find('[data-file-upload-role=file-status]').html($error);\n        this.updateFileInfoUI();\n        this.removeFileListItem();\n    }\n\n    aborted() {\n        this.removeFileListItem();\n    }\n\n    removeFileListItem() {\n        if (this.fileListItem) {\n            this.fileList.removeByUid(this.fileListItem.uid);\n            this.fileListItem = null;\n        }\n    }\n\n    done(file) {\n        this.status = 'done';\n        this.updateFileInfo(file);\n        const $done = $(this.$filesContainer.data('templateDone'));\n        this.updateFileInfoUI($done);\n        this.$file.find('[data-file-upload-role=file-status]').html($done);\n        this.updateFileInfoUI();\n    }\n\n    updateFileInfoUI(element) {\n        this.$file.attr('data-file-upload-status', this.status);\n        this.$file.attr('data-content-type', this.type);\n        this.$file.attr('title', this.name);\n\n        const $element = $(element || this.$file);\n        $element.find('[data-file-upload-role=file-name]').text(this.name);\n        $element.find('[data-file-upload-role=file-size]').text(this.formatBytes(this.size));\n        $element.find('[data-file-upload-role=file-progress-bar]')\n            .attr('aria-valuenow', Math.floor(this.progress))\n            .css('width', this.progress.toFixed(2) + '%');\n        if (this.error) {\n            $element.find('[data-file-upload-role=file-error]').text(this.error);\n        }\n        if (this.deleteUrl) {\n            $element.find('[data-file-upload-role=file-delete]').attr('data-url', this.deleteUrl);\n        }\n        if (this.downloadUrl) {\n            $element.find('[data-file-upload-role=file-download]').attr('href', this.downloadUrl);\n        }\n        if (this.thumbnailUrl) {\n            const $thumbnail = $element.find('[data-file-upload-role=file-thumbnail]');\n            if ($thumbnail.is('img')) {\n                $thumbnail.attr('src', this.thumbnailUrl);\n            } else if ($thumbnail.length > 0) {\n                const thumbnailAttributes = {};\n                $.each($thumbnail.get(0).attributes, (idx, attribute) => {\n                    thumbnailAttributes[attribute.name] = attribute.value;\n                });\n                $thumbnail.replaceWith($('<img>').attr(thumbnailAttributes).attr('src', this.thumbnailUrl));\n            }\n        }\n    }\n\n    formatBytes(bytes) {\n        const units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB'];\n        let unit;\n        for (let i = 0; i < units.length; i++) {\n            unit = units[i];\n            if (Math.abs(bytes) < 1024 || i === units.length - 1) {\n                break;\n            }\n            bytes = bytes / 1024;\n        }\n        return bytes.toFixed(2) + ' ' + unit;\n    }\n\n}\n\n\nexport default FileUpload;\n"],"names":[],"mappings":"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"}
{"version":3,"file":"file-upload-control.js","sources":["../../src/assets/js/ui/Button.js","../../src/assets/js/ui/Buttons.js","../../src/assets/js/ui/FilesList.js","../../src/assets/js/ui/FileUpload.js","../../src/assets/js/index.js","../../src/assets/js/file-upload-control.js"],"sourcesContent":["import $ from 'jquery';\n\nclass Button {\n\n    constructor($fileUpload, buttonSelector, targetSelector) {\n        this.$fileUpload = $fileUpload;\n        this.button = $fileUpload.find(buttonSelector);\n        this.targetSelector = targetSelector;\n\n        this.button.click(() => {\n            // Trigger click from the newest to oldest to mitigate race condition bug with limitConcurrentUploads\n            $(this.$fileUpload.find(this.targetSelector).get().reverse()).click();\n        });\n    }\n\n    refreshState() {\n        this.button.toggleClass('disabled', this.$fileUpload.find(this.targetSelector).length === 0);\n    }\n\n}\n\n\nexport default Button;\n","import Button from './Button';\n\n\nclass Buttons {\n\n    constructor($fileUpload) {\n        this.abortButton = new Button($fileUpload, '[data-file-upload-role=abort]', '[data-file-upload-status=processing] [data-file-upload-role=file-delete]');\n        this.deleteButton = new Button($fileUpload, '[data-file-upload-role=delete]', '[data-file-upload-role=file-delete]');\n    }\n\n    refreshState() {\n        this.abortButton.refreshState();\n        this.deleteButton.refreshState();\n    }\n\n}\n\n\nexport default Buttons;\n","import $ from 'jquery';\n\nclass FilesList {\n\n    constructor($fileUpload) {\n        this.$fileUpload = $fileUpload;\n        this.dataAttribute = 'files';\n    }\n\n    getInput() {\n        // We need to do a lookup every time, because file input is replaced after each upload\n        return this.$fileUpload.find('input[type=file]');\n    }\n\n    list() {\n        return this.getInput().data(this.dataAttribute) || [];\n    }\n\n    add(file) {\n        const files = this.list();\n        files.push(file);\n        this.getInput().data(this.dataAttribute, files);\n    }\n\n    /**\n     * @deprecated\n     */\n    remove(fileUrl) {\n        this.getInput().data(this.dataAttribute, $.grep(\n            this.list(),\n            (file) => {\n                return file.url !== fileUrl;\n            },\n        ));\n    }\n\n    removeByDeleteUrl(deleteUrl) {\n        this.getInput().data(this.dataAttribute, $.grep(\n            this.list(),\n            (file) => {\n                return file.deleteUrl !== deleteUrl;\n            },\n        ));\n    }\n\n    removeByUid(uid) {\n        this.getInput().data(this.dataAttribute, $.grep(\n            this.list(),\n            (file) => {\n                return file.uid !== uid;\n            },\n        ));\n    }\n\n}\n\n\nexport default FilesList;\n","import $ from 'jquery';\nimport FilesList from './FilesList';\n\nclass FileUpload {\n\n    constructor($fileUpload, files) {\n        let name = '';\n        let size = 0;\n        let type = '';\n        $.each(files, (index, file) => {\n            name = name + (index ? ', ' : '') + file.name;\n            size = size + file.size;\n            type = type || file.type;\n            if (type !== file.type) {\n                type = type + ', ' + file.type;\n            }\n        });\n\n        this.name = name;\n        this.size = size;\n        this.type = type;\n        this.status = 'processing';\n        this.progress = 0;\n        this.deleteUrl = null;\n        this.downloadUrl = null;\n        this.thumbnailUrl = null;\n        this.error = null;\n        this.$filesContainer = $fileUpload.find('[data-file-upload-role=files]');\n        this.$file = this.createUI();\n\n        const uid = [name, size, Math.floor(Math.random() * 2**32)].join('|');\n        this.fileListItem = {name, size, type, uid};\n        this.fileList = new FilesList($fileUpload);\n        this.fileList.add(this.fileListItem);\n\n        this.updateFileInfoUI();\n        this.$filesContainer.append(this.$file);\n        this.$file.fadeIn();\n    }\n\n    createUI() {\n        const $file = $(this.$filesContainer.data('templateFile'));\n        $file.find('[data-file-upload-role=file-status]').append($(this.$filesContainer.data('templateProcessing')));\n        $file.hide();\n        return $file;\n    }\n\n    updateProgress(progress) {\n        this.progress = Math.max(0, Math.min(progress, 1)) * 100;\n        this.updateFileInfoUI();\n    }\n\n    updateFileInfo(file) {\n        this.downloadUrl = file.url || this.downloadUrl;\n        this.thumbnailUrl = file.thumbnailUrl || this.thumbnailUrl;\n        this.deleteUrl = file.deleteUrl || this.deleteUrl;\n        this.type = file.type || this.type;\n        this.replaceFileListItem(file);\n    }\n\n    replaceFileListItem(file) {\n        if (this.fileListItem) {\n            this.fileList.removeByUid(this.fileListItem.uid);\n            this.fileList.add(file);\n            this.fileListItem = null;\n        }\n    }\n\n    processing(file) {\n        this.updateFileInfo(file);\n        this.updateFileInfoUI();\n    }\n\n    failed(file) {\n        this.status = 'failed';\n        if (file && file.error) {\n            this.error = file.error;\n        }\n        const $error = $(this.$filesContainer.data('templateFailed'));\n        this.updateFileInfoUI($error);\n        this.$file.find('[data-file-upload-role=file-status]').html($error);\n        this.updateFileInfoUI();\n        this.removeFileListItem();\n    }\n\n    aborted() {\n        this.removeFileListItem();\n    }\n\n    removeFileListItem() {\n        if (this.fileListItem) {\n            this.fileList.removeByUid(this.fileListItem.uid);\n            this.fileListItem = null;\n        }\n    }\n\n    done(file) {\n        this.status = 'done';\n        this.updateFileInfo(file);\n        const $done = $(this.$filesContainer.data('templateDone'));\n        this.updateFileInfoUI($done);\n        this.$file.find('[data-file-upload-role=file-status]').html($done);\n        this.updateFileInfoUI();\n    }\n\n    updateFileInfoUI(element) {\n        this.$file.attr('data-file-upload-status', this.status);\n        this.$file.attr('data-content-type', this.type);\n        this.$file.attr('title', this.name);\n\n        const $element = $(element || this.$file);\n        $element.find('[data-file-upload-role=file-name]').text(this.name);\n        $element.find('[data-file-upload-role=file-size]').text(this.formatBytes(this.size));\n        $element.find('[data-file-upload-role=file-progress-bar]')\n            .attr('aria-valuenow', Math.floor(this.progress))\n            .css('width', this.progress.toFixed(2) + '%');\n        if (this.error) {\n            $element.find('[data-file-upload-role=file-error]').text(this.error);\n        }\n        if (this.deleteUrl) {\n            $element.find('[data-file-upload-role=file-delete]').attr('data-url', this.deleteUrl);\n        }\n        if (this.downloadUrl) {\n            $element.find('[data-file-upload-role=file-download]').attr('href', this.downloadUrl);\n        }\n        if (this.thumbnailUrl) {\n            const $thumbnail = $element.find('[data-file-upload-role=file-thumbnail]');\n            if ($thumbnail.is('img')) {\n                $thumbnail.attr('src', this.thumbnailUrl);\n            } else if ($thumbnail.length > 0) {\n                const thumbnailAttributes = {};\n                $.each($thumbnail.get(0).attributes, (idx, attribute) => {\n                    thumbnailAttributes[attribute.name] = attribute.value;\n                });\n                $thumbnail.replaceWith($('<img>').attr(thumbnailAttributes).attr('src', this.thumbnailUrl));\n            }\n        }\n    }\n\n    formatBytes(bytes) {\n        const units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB'];\n        let unit;\n        for (let i = 0; i < units.length; i++) {\n            unit = units[i];\n            if (Math.abs(bytes) < 1024 || i === units.length - 1) {\n                break;\n            }\n            bytes = bytes / 1024;\n        }\n        return bytes.toFixed(2) + ' ' + unit;\n    }\n\n}\n\n\nexport default FileUpload;\n","import $ from 'jquery';\nimport 'blueimp-file-upload';\nimport {Buttons, FilesList, FileUpload} from './ui';\n\n\nfunction initializeControl(container) {\n    const $fileUpload = $(container);\n    if ($fileUpload.data('blueimpFileupload')) {\n        return;\n    }\n\n    const uniqueFilenames = {};\n    ($fileUpload.data('uniqueFilenames') || []).forEach((filename) => {\n        uniqueFilenames[filename] = true;\n    });\n\n    $fileUpload.fileupload({\n        url: $fileUpload.data('fileUploadUrl'),\n        dropZone: $fileUpload,\n        pasteZone: null,\n        dataType: 'json',\n        formData: [], // do not send other form data with file uploads\n        uniqueFilenames,\n        singleFileUploads: true,\n        maxChunkSize: 2 * 1024 * 1024,\n        limitConcurrentUploads: 3,\n        submit: () => {\n            return !$fileUpload.hasClass('disabled') && !$fileUpload.is(':disabled') && !$fileUpload.find('input[type=file]').prop('disabled');\n        },\n    });\n\n    const filesList = new FilesList($fileUpload);\n    const buttons = new Buttons($fileUpload);\n\n    // eslint-disable-next-line consistent-return\n    $fileUpload.on('fileuploadadd', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload = new FileUpload($fileUpload, data.files);\n        data.fileUpload.$file.data('upload', data);\n        buttons.refreshState();\n\n    // eslint-disable-next-line consistent-return\n    }).on('fileuploadprogress', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload.updateProgress(data.loaded / data.total);\n\n    }).on('fileuploadfail', (e, data) => {\n        if (!data.fileUpload) {\n            return;\n        }\n        if (data.errorThrown === 'abort') {\n            data.fileUpload.aborted();\n        } else {\n            data.fileUpload.failed();\n            buttons.refreshState();\n        }\n\n    }).on('fileuploaddone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n        } else {\n            data.fileUpload.done(file);\n        }\n        buttons.refreshState();\n\n    }).on('fileuploadchunkdone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n            buttons.refreshState();\n        } else {\n            data.fileUpload.processing(file);\n        }\n\n    }).on('fileuploadchunksend', (e, data) => {\n        return !data.fileUpload || data.fileUpload.status !== 'failed';\n\n    }).on('click', '[data-file-upload-role=file-delete]', function () {\n        const $this = $(this);\n        const $file = $this.closest('[data-file-upload-role=file]');\n        const upload = $file.data('upload');\n        if (upload) {\n            upload.abort();\n        }\n        const deleteUrl = $this.data('url');\n        if (deleteUrl) {\n            $.get(deleteUrl);\n            filesList.removeByDeleteUrl(deleteUrl);\n        }\n        $file.fadeOut(() => {\n            $file.remove();\n            buttons.refreshState();\n        });\n\n    });\n}\n\n\nfunction initializeForm(form) {\n    $(form)\n        .find('[data-file-upload-url]')\n        .each((idx, container) => {\n            initializeControl(container);\n        });\n}\n\n\nfunction initializeFileUploadControl(Nette) {\n    // Disable default browser drop event\n    $(document).on('drop dragover', (e) => {\n        e.preventDefault();\n    });\n\n    // Validation\n    Nette.validators.NepadaFileUploadControlValidationClientSide_noUploadInProgress = (element) => {\n        return $(element).closest('[data-file-upload-url]').find('[data-file-upload-status=processing] [data-file-upload-role=file-delete]').length === 0;\n    };\n\n    // Effective value\n    const originalGetEffectiveValue = Nette.getEffectiveValue;\n    Nette.getEffectiveValue = (elem, filter) => {\n        if (!elem || !elem.nodeName || elem.nodeName.toLowerCase() !== 'input' || !$(elem).data('files')) {\n            return originalGetEffectiveValue.apply(Nette, [elem, filter]);\n        }\n        return $(elem).data('files');\n    };\n\n    // Initialize all forms on document ready\n    $(() => {\n        $('form').each((idx, form) => {\n            initializeForm(form);\n        });\n    });\n\n    // Tap into Nette.initForm() to provide AJAX snippet support via e.g. Naja\n    const originalInitForm = Nette.initForm;\n    Nette.initForm = (form) => {\n        originalInitForm.apply(Nette, [form]);\n        initializeForm(form);\n    };\n}\n\n\nexport default initializeFileUploadControl;\n","import Nette from 'nette-forms';\nimport initializeFileUploadControl from './index';\n\ninitializeFileUploadControl(Nette);\n"],"names":["Button","constructor","$fileUpload","buttonSelector","targetSelector","button","find","click","$","get","reverse","refreshState","toggleClass","length","Buttons","abortButton","deleteButton","FilesList","dataAttribute","getInput","list","data","add","file","files","push","remove","fileUrl","grep","url","removeByDeleteUrl","deleteUrl","removeByUid","uid","FileUpload","name","size","type","each","index","status","progress","downloadUrl","thumbnailUrl","error","$filesContainer","$file","createUI","Math","floor","random","join","fileListItem","fileList","updateFileInfoUI","append","fadeIn","hide","updateProgress","max","min","updateFileInfo","replaceFileListItem","processing","failed","$error","html","removeFileListItem","aborted","done","$done","element","attr","$element","text","formatBytes","css","toFixed","$thumbnail","is","thumbnailAttributes","attributes","idx","attribute","value","replaceWith","bytes","units","unit","i","abs","initializeControl","container","uniqueFilenames","forEach","filename","fileupload","dropZone","pasteZone","dataType","formData","singleFileUploads","maxChunkSize","limitConcurrentUploads","submit","hasClass","prop","filesList","buttons","on","e","isDefaultPrevented","fileUpload","loaded","total","errorThrown","result","$this","closest","upload","abort","fadeOut","initializeForm","form","initializeFileUploadControl","Nette","document","preventDefault","validators","NepadaFileUploadControlValidationClientSide_noUploadInProgress","originalGetEffectiveValue","getEffectiveValue","elem","filter","nodeName","toLowerCase","apply","originalInitForm","initForm"],"mappings":"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"}
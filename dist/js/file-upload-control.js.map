{"version":3,"file":"file-upload-control.js","sources":["../../src/assets/js/ui/Button.js","../../src/assets/js/ui/Buttons.js","../../src/assets/js/ui/FilesList.js","../../src/assets/js/ui/FileUpload.js","../../src/assets/js/index.js","../../src/assets/js/file-upload-control.js"],"sourcesContent":["import $ from 'jquery';\n\nclass Button {\n\n    constructor($fileUpload, buttonSelector, targetSelector) {\n        this.$fileUpload = $fileUpload;\n        this.button = $fileUpload.find(buttonSelector);\n        this.targetSelector = targetSelector;\n\n        this.button.click(() => {\n            // Trigger click from the newest to oldest to mitigate race condition bug with limitConcurrentUploads\n            $(this.$fileUpload.find(this.targetSelector).get().reverse()).click();\n        });\n    }\n\n    refreshState() {\n        this.button.toggleClass('disabled', this.$fileUpload.find(this.targetSelector).length === 0);\n    }\n\n}\n\n\nexport default Button;\n","import Button from './Button';\n\n\nclass Buttons {\n\n    constructor($fileUpload) {\n        this.abortButton = new Button($fileUpload, '[data-file-upload-role=abort]', '[data-file-upload-status=processing] [data-file-upload-role=file-delete]');\n        this.deleteButton = new Button($fileUpload, '[data-file-upload-role=delete]', '[data-file-upload-role=file-delete]');\n    }\n\n    refreshState() {\n        this.abortButton.refreshState();\n        this.deleteButton.refreshState();\n    }\n\n}\n\n\nexport default Buttons;\n","import $ from 'jquery';\n\nclass FilesList {\n\n    constructor($fileUpload) {\n        this.$fileUpload = $fileUpload;\n        this.dataAttribute = 'files';\n    }\n\n    getInput() {\n        // We need to do a lookup every time, because file input is replaced after each upload\n        return this.$fileUpload.find('input[type=file]');\n    }\n\n    list() {\n        return this.getInput().data(this.dataAttribute) || [];\n    }\n\n    add(file) {\n        const files = this.list();\n        files.push(file);\n        this.getInput().data(this.dataAttribute, files);\n    }\n\n    remove(fileUrl) {\n        this.getInput().data(this.dataAttribute, $.grep(\n            this.list(),\n            (file) => {\n                return file.url !== fileUrl;\n            },\n        ));\n    }\n\n}\n\n\nexport default FilesList;\n","import $ from 'jquery';\n\nclass FileUpload {\n\n    constructor($fileUpload, files) {\n        let name = '';\n        let size = 0;\n        let type = '';\n        $.each(files, (index, file) => {\n            name = name + (index ? ', ' : '') + file.name;\n            size = size + file.size;\n            type = type || file.type;\n            if (type !== file.type) {\n                type = type + ', ' + file.type;\n            }\n        });\n\n        this.name = name;\n        this.size = size;\n        this.type = type;\n        this.status = 'processing';\n        this.progress = 0;\n        this.deleteUrl = null;\n        this.downloadUrl = null;\n        this.thumbnailUrl = null;\n        this.error = null;\n        this.$filesContainer = $fileUpload.find('[data-file-upload-role=files]');\n        this.$file = this.createUI();\n\n        this.updateFileInfoUI();\n        this.$filesContainer.append(this.$file);\n        this.$file.fadeIn();\n    }\n\n    createUI() {\n        const $file = $(this.$filesContainer.data('templateFile'));\n        $file.find('[data-file-upload-role=file-status]').append($(this.$filesContainer.data('templateProcessing')));\n        $file.hide();\n        return $file;\n    }\n\n    updateProgress(progress) {\n        this.progress = Math.max(0, Math.min(progress, 1)) * 100;\n        this.updateFileInfoUI();\n    }\n\n    updateFileInfo(file) {\n        this.downloadUrl = file.url || this.downloadUrl;\n        this.thumbnailUrl = file.thumbnailUrl || this.thumbnailUrl;\n        this.deleteUrl = file.deleteUrl || this.deleteUrl;\n        this.type = file.type || this.type;\n    }\n\n    processing(file) {\n        this.updateFileInfo(file);\n        this.updateFileInfoUI();\n    }\n\n    failed(file) {\n        this.status = 'failed';\n        if (file && file.error) {\n            this.error = file.error;\n        }\n        const $error = $(this.$filesContainer.data('templateFailed'));\n        this.updateFileInfoUI($error);\n        this.$file.find('[data-file-upload-role=file-status]').html($error);\n        this.updateFileInfoUI();\n    }\n\n    done(file) {\n        this.status = 'done';\n        this.updateFileInfo(file);\n        const $done = $(this.$filesContainer.data('templateDone'));\n        this.updateFileInfoUI($done);\n        this.$file.find('[data-file-upload-role=file-status]').html($done);\n        this.updateFileInfoUI();\n    }\n\n    updateFileInfoUI(element) {\n        this.$file.attr('data-file-upload-status', this.status);\n        this.$file.attr('data-content-type', this.type);\n        this.$file.attr('title', this.name);\n\n        const $element = $(element || this.$file);\n        $element.find('[data-file-upload-role=file-name]').text(this.name);\n        $element.find('[data-file-upload-role=file-size]').text(this.formatBytes(this.size));\n        $element.find('[data-file-upload-role=file-progress-bar]')\n            .attr('aria-valuenow', Math.floor(this.progress))\n            .css('width', this.progress.toFixed(2) + '%');\n        if (this.error) {\n            $element.find('[data-file-upload-role=file-error]').text(this.error);\n        }\n        if (this.deleteUrl) {\n            $element.find('[data-file-upload-role=file-delete]').attr('data-url', this.deleteUrl);\n        }\n        if (this.downloadUrl) {\n            $element.find('[data-file-upload-role=file-download]').attr('href', this.downloadUrl);\n        }\n        if (this.thumbnailUrl) {\n            const $thumbnail = $element.find('[data-file-upload-role=file-thumbnail]');\n            if ($thumbnail.is('img')) {\n                $thumbnail.attr('src', this.thumbnailUrl);\n            } else if ($thumbnail.length > 0) {\n                const thumbnailAttributes = {};\n                $.each($thumbnail.get(0).attributes, (idx, attribute) => {\n                    thumbnailAttributes[attribute.name] = attribute.value;\n                });\n                $thumbnail.replaceWith($('<img>').attr(thumbnailAttributes).attr('src', this.thumbnailUrl));\n            }\n        }\n    }\n\n    formatBytes(bytes) {\n        const units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB'];\n        let unit;\n        for (let i = 0; i < units.length; i++) {\n            unit = units[i];\n            if (Math.abs(bytes) < 1024 || i === units.length - 1) {\n                break;\n            }\n            bytes = bytes / 1024;\n        }\n        return bytes.toFixed(2) + ' ' + unit;\n    }\n\n}\n\n\nexport default FileUpload;\n","import $ from 'jquery';\nimport 'blueimp-file-upload';\nimport {Buttons, FilesList, FileUpload} from './ui';\n\n\nfunction initializeControl(container) {\n    const $fileUpload = $(container);\n    if ($fileUpload.data('blueimpFileupload')) {\n        return;\n    }\n\n    const uniqueFilenames = {};\n    ($fileUpload.data('uniqueFilenames') || []).forEach((filename) => {\n        uniqueFilenames[filename] = true;\n    });\n\n    $fileUpload.fileupload({\n        url: $fileUpload.data('fileUploadUrl'),\n        dropZone: $fileUpload,\n        pasteZone: null,\n        dataType: 'json',\n        formData: [], // do not send other form data with file uploads\n        uniqueFilenames,\n        singleFileUploads: true,\n        maxChunkSize: 2 * 1024 * 1024,\n        limitConcurrentUploads: 3,\n        submit: () => {\n            return !$fileUpload.hasClass('disabled') && !$fileUpload.is(':disabled') && !$fileUpload.find('input[type=file]').prop('disabled');\n        },\n    });\n\n    const filesList = new FilesList($fileUpload);\n    const buttons = new Buttons($fileUpload);\n\n    // eslint-disable-next-line consistent-return\n    $fileUpload.on('fileuploadadd', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload = new FileUpload($fileUpload, data.files);\n        data.fileUpload.$file.data('upload', data);\n        buttons.refreshState();\n\n    // eslint-disable-next-line consistent-return\n    }).on('fileuploadprogress', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload.updateProgress(data.loaded / data.total);\n\n    }).on('fileuploadfail', (e, data) => {\n        if (data.fileUpload && data.errorThrown !== 'abort') {\n            data.fileUpload.failed();\n            buttons.refreshState();\n        }\n\n    }).on('fileuploaddone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n        } else {\n            data.fileUpload.done(file);\n            filesList.add(file);\n        }\n        buttons.refreshState();\n\n    }).on('fileuploadchunkdone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n            buttons.refreshState();\n        } else {\n            data.fileUpload.processing(file);\n        }\n\n    }).on('fileuploadchunksend', (e, data) => {\n        return !data.fileUpload || data.fileUpload.status !== 'failed';\n\n    }).on('click', '[data-file-upload-role=file-delete]', function () {\n        const $this = $(this);\n        const $file = $this.closest('[data-file-upload-role=file]');\n        const upload = $file.data('upload');\n        if (upload) {\n            upload.abort();\n        }\n        if ($this.is('[data-url]')) {\n            $.get($this.data('url'));\n        }\n        const fileUrl = $file.find('[data-file-upload-role=file-download]').attr('href');\n        filesList.remove(fileUrl);\n        $file.fadeOut(() => {\n            $file.remove();\n            buttons.refreshState();\n        });\n\n    });\n}\n\n\nfunction initializeForm(form) {\n    $(form)\n        .find('[data-file-upload-url]')\n        .each((idx, container) => {\n            initializeControl(container);\n        });\n}\n\n\nfunction initializeFileUploadControl(Nette) {\n    // Disable default browser drop event\n    $(document).on('drop dragover', (e) => {\n        e.preventDefault();\n    });\n\n    // Effective value\n    const originalGetEffectiveValue = Nette.getEffectiveValue;\n    Nette.getEffectiveValue = (elem, filter) => {\n        if (!elem || !elem.nodeName || elem.nodeName.toLowerCase() !== 'input' || !$(elem).data('files')) {\n            return originalGetEffectiveValue(elem, filter);\n        }\n        return $(elem).data('files');\n    };\n\n    // Initialize all forms on document ready\n    $(() => {\n        $('form').each((idx, form) => {\n            initializeForm(form);\n        });\n    });\n\n    // Tap into Nette.initForm() to provide AJAX snippet support via e.g. Naja\n    const originalInitForm = Nette.initForm;\n    Nette.initForm = (form) => {\n        originalInitForm(form);\n        initializeForm(form);\n    };\n}\n\n\nexport default initializeFileUploadControl;\n","import Nette from 'nette-forms';\nimport initializeFileUploadControl from './index';\n\ninitializeFileUploadControl(Nette);\n"],"names":["Button","$fileUpload","buttonSelector","targetSelector","button","find","click","$","get","reverse","toggleClass","length","Buttons","abortButton","deleteButton","refreshState","FilesList","dataAttribute","getInput","data","file","files","list","push","fileUrl","grep","url","FileUpload","name","size","type","each","index","status","progress","deleteUrl","downloadUrl","thumbnailUrl","error","$filesContainer","$file","createUI","updateFileInfoUI","append","fadeIn","hide","Math","max","min","updateFileInfo","$error","html","$done","element","attr","$element","text","formatBytes","floor","css","toFixed","$thumbnail","is","thumbnailAttributes","attributes","idx","attribute","value","replaceWith","bytes","units","unit","i","abs","initializeControl","container","uniqueFilenames","forEach","filename","fileupload","dropZone","pasteZone","dataType","formData","singleFileUploads","maxChunkSize","limitConcurrentUploads","submit","hasClass","prop","filesList","buttons","on","e","isDefaultPrevented","fileUpload","updateProgress","loaded","total","errorThrown","failed","result","done","add","processing","$this","closest","upload","abort","remove","fadeOut","initializeForm","form","initializeFileUploadControl","Nette","document","preventDefault","originalGetEffectiveValue","getEffectiveValue","elem","filter","nodeName","toLowerCase","originalInitForm","initForm"],"mappings":"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"}
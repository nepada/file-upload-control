{"version":3,"file":"file-upload-control.js","sources":["../../src/assets/js/ui/Button.js","../../src/assets/js/ui/Buttons.js","../../src/assets/js/ui/FilesList.js","../../src/assets/js/ui/FileUpload.js","../../src/assets/js/index.js","../../src/assets/js/file-upload-control.js"],"sourcesContent":["import $ from 'jquery';\n\nclass Button {\n\n    constructor($fileUpload, buttonSelector, targetSelector) {\n        this.$fileUpload = $fileUpload;\n        this.button = $fileUpload.find(buttonSelector);\n        this.targetSelector = targetSelector;\n\n        this.button.click(() => {\n            // Trigger click from the newest to oldest to mitigate race condition bug with limitConcurrentUploads\n            $(this.$fileUpload.find(this.targetSelector).get().reverse()).click();\n        });\n    }\n\n    refreshState() {\n        this.button.toggleClass('disabled', this.$fileUpload.find(this.targetSelector).length === 0);\n    }\n\n}\n\n\nexport default Button;\n","import Button from './Button';\n\n\nclass Buttons {\n\n    constructor($fileUpload) {\n        this.abortButton = new Button($fileUpload, '[data-file-upload-role=abort]', '[data-file-upload-status=processing] [data-file-upload-role=file-delete]');\n        this.deleteButton = new Button($fileUpload, '[data-file-upload-role=delete]', '[data-file-upload-role=file-delete]');\n    }\n\n    refreshState() {\n        this.abortButton.refreshState();\n        this.deleteButton.refreshState();\n    }\n\n}\n\n\nexport default Buttons;\n","import $ from 'jquery';\n\nclass FilesList {\n\n    constructor($fileUpload) {\n        this.$fileUpload = $fileUpload;\n        this.dataAttribute = 'files';\n    }\n\n    getInput() {\n        // We need to do a lookup every time, because file input is replaced after each upload\n        return this.$fileUpload.find('input[type=file]');\n    }\n\n    list() {\n        return this.getInput().data(this.dataAttribute) || [];\n    }\n\n    add(file) {\n        const files = this.list();\n        files.push(file);\n        this.getInput().data(this.dataAttribute, files);\n    }\n\n    remove(fileUrl) {\n        this.getInput().data(this.dataAttribute, $.grep(\n            this.list(),\n            (file) => {\n                return file.url !== fileUrl;\n            },\n        ));\n    }\n\n}\n\n\nexport default FilesList;\n","import $ from 'jquery';\n\nclass FileUpload {\n\n    constructor($fileUpload, files) {\n        let name = '';\n        let size = 0;\n        let type = '';\n        $.each(files, (index, file) => {\n            name = name + (index ? ', ' : '') + file.name;\n            size = size + file.size;\n            type = type || file.type;\n            if (type !== file.type) {\n                type = type + ', ' + file.type;\n            }\n        });\n\n        this.name = name;\n        this.size = size;\n        this.type = type;\n        this.status = 'processing';\n        this.progress = 0;\n        this.deleteUrl = null;\n        this.downloadUrl = null;\n        this.thumbnailUrl = null;\n        this.error = null;\n        this.$filesContainer = $fileUpload.find('[data-file-upload-role=files]');\n        this.$file = this.createUI();\n\n        this.updateFileInfoUI();\n        this.$filesContainer.append(this.$file);\n        this.$file.fadeIn();\n    }\n\n    createUI() {\n        const $file = $(this.$filesContainer.data('templateFile'));\n        $file.find('[data-file-upload-role=file-status]').append($(this.$filesContainer.data('templateProcessing')));\n        $file.hide();\n        return $file;\n    }\n\n    updateProgress(progress) {\n        this.progress = Math.max(0, Math.min(progress, 1)) * 100;\n        this.updateFileInfoUI();\n    }\n\n    updateFileInfo(file) {\n        this.downloadUrl = file.url || this.downloadUrl;\n        this.thumbnailUrl = file.thumbnailUrl || this.thumbnailUrl;\n        this.deleteUrl = file.deleteUrl || this.deleteUrl;\n        this.type = file.type || this.type;\n    }\n\n    processing(file) {\n        this.updateFileInfo(file);\n        this.updateFileInfoUI();\n    }\n\n    failed(file) {\n        this.status = 'failed';\n        if (file && file.error) {\n            this.error = file.error;\n        }\n        const $error = $(this.$filesContainer.data('templateFailed'));\n        this.updateFileInfoUI($error);\n        this.$file.find('[data-file-upload-role=file-status]').html($error);\n        this.updateFileInfoUI();\n    }\n\n    done(file) {\n        this.status = 'done';\n        this.updateFileInfo(file);\n        const $done = $(this.$filesContainer.data('templateDone'));\n        this.updateFileInfoUI($done);\n        this.$file.find('[data-file-upload-role=file-status]').html($done);\n        this.updateFileInfoUI();\n    }\n\n    updateFileInfoUI(element) {\n        this.$file.attr('data-file-upload-status', this.status);\n        this.$file.attr('data-content-type', this.type);\n        this.$file.attr('title', this.name);\n\n        const $element = $(element || this.$file);\n        $element.find('[data-file-upload-role=file-name]').text(this.name);\n        $element.find('[data-file-upload-role=file-size]').text(this.formatBytes(this.size));\n        $element.find('[data-file-upload-role=file-progress-bar]')\n            .attr('aria-valuenow', Math.floor(this.progress))\n            .css('width', this.progress.toFixed(2) + '%');\n        if (this.error) {\n            $element.find('[data-file-upload-role=file-error]').text(this.error);\n        }\n        if (this.deleteUrl) {\n            $element.find('[data-file-upload-role=file-delete]').attr('data-url', this.deleteUrl);\n        }\n        if (this.downloadUrl) {\n            $element.find('[data-file-upload-role=file-download]').attr('href', this.downloadUrl);\n        }\n        if (this.thumbnailUrl) {\n            const $thumbnail = $element.find('[data-file-upload-role=file-thumbnail]');\n            if ($thumbnail.is('img')) {\n                $thumbnail.attr('src', this.thumbnailUrl);\n            } else if ($thumbnail.length > 0) {\n                const thumbnailAttributes = {};\n                $.each($thumbnail.get(0).attributes, (idx, attribute) => {\n                    thumbnailAttributes[attribute.name] = attribute.value;\n                });\n                $thumbnail.replaceWith($('<img>').attr(thumbnailAttributes).attr('src', this.thumbnailUrl));\n            }\n        }\n    }\n\n    formatBytes(bytes) {\n        const units = ['B', 'kB', 'MB', 'GB', 'TB', 'PB'];\n        let unit;\n        for (let i = 0; i < units.length; i++) {\n            unit = units[i];\n            if (Math.abs(bytes) < 1024 || i === units.length - 1) {\n                break;\n            }\n            bytes = bytes / 1024;\n        }\n        return bytes.toFixed(2) + ' ' + unit;\n    }\n\n}\n\n\nexport default FileUpload;\n","import $ from 'jquery';\nimport 'blueimp-file-upload';\nimport {Buttons, FilesList, FileUpload} from './ui';\n\n\nfunction initializeControl(container) {\n    const $fileUpload = $(container);\n    if ($fileUpload.data('blueimpFileupload')) {\n        return;\n    }\n\n    const uniqueFilenames = {};\n    ($fileUpload.data('uniqueFilenames') || []).forEach((filename) => {\n        uniqueFilenames[filename] = true;\n    });\n\n    $fileUpload.fileupload({\n        url: $fileUpload.data('fileUploadUrl'),\n        dropZone: $fileUpload,\n        pasteZone: null,\n        dataType: 'json',\n        formData: [], // do not send other form data with file uploads\n        uniqueFilenames,\n        singleFileUploads: true,\n        maxChunkSize: 2 * 1024 * 1024,\n        limitConcurrentUploads: 3,\n        submit: () => {\n            return !$fileUpload.hasClass('disabled') && !$fileUpload.is(':disabled') && !$fileUpload.find('input[type=file]').prop('disabled');\n        },\n    });\n\n    const filesList = new FilesList($fileUpload);\n    const buttons = new Buttons($fileUpload);\n\n    // eslint-disable-next-line consistent-return\n    $fileUpload.on('fileuploadadd', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload = new FileUpload($fileUpload, data.files);\n        data.fileUpload.$file.data('upload', data);\n        buttons.refreshState();\n\n    // eslint-disable-next-line consistent-return\n    }).on('fileuploadprogress', (e, data) => {\n        if (e.isDefaultPrevented()) {\n            return false;\n        }\n\n        data.fileUpload.updateProgress(data.loaded / data.total);\n\n    }).on('fileuploadfail', (e, data) => {\n        if (data.fileUpload && data.errorThrown !== 'abort') {\n            data.fileUpload.failed();\n            buttons.refreshState();\n        }\n\n    }).on('fileuploaddone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n        } else {\n            data.fileUpload.done(file);\n            filesList.add(file);\n        }\n        buttons.refreshState();\n\n    }).on('fileuploadchunkdone', (e, data) => {\n        const file = data.result.files[0];\n        if (file.error) {\n            data.fileUpload.failed(file);\n            buttons.refreshState();\n        } else {\n            data.fileUpload.processing(file);\n        }\n\n    }).on('fileuploadchunksend', (e, data) => {\n        return !data.fileUpload || data.fileUpload.status !== 'failed';\n\n    }).on('click', '[data-file-upload-role=file-delete]', function () {\n        const $this = $(this);\n        const $file = $this.closest('[data-file-upload-role=file]');\n        const upload = $file.data('upload');\n        if (upload) {\n            upload.abort();\n        }\n        if ($this.is('[data-url]')) {\n            $.get($this.data('url'));\n        }\n        const fileUrl = $file.find('[data-file-upload-role=file-download]').attr('href');\n        filesList.remove(fileUrl);\n        $file.fadeOut(() => {\n            $file.remove();\n            buttons.refreshState();\n        });\n\n    });\n}\n\n\nfunction initializeForm(form) {\n    $(form)\n        .find('[data-file-upload-url]')\n        .each((idx, container) => {\n            initializeControl(container);\n        });\n}\n\n\nfunction initializeFileUploadControl(Nette) {\n    // Disable default browser drop event\n    $(document).on('drop dragover', (e) => {\n        e.preventDefault();\n    });\n\n    // Effective value\n    const originalGetEffectiveValue = Nette.getEffectiveValue;\n    Nette.getEffectiveValue = (elem, filter) => {\n        if (!elem || !elem.nodeName || elem.nodeName.toLowerCase() !== 'input' || !$(elem).data('files')) {\n            return originalGetEffectiveValue(elem, filter);\n        }\n        return $(elem).data('files');\n    };\n\n    // Initialize all forms on document ready\n    $(() => {\n        $('form').each((idx, form) => {\n            initializeForm(form);\n        });\n    });\n\n    // Tap into Nette.initForm() to provide AJAX snippet support via e.g. Naja\n    const originalInitForm = Nette.initForm;\n    Nette.initForm = (form) => {\n        originalInitForm(form);\n        initializeForm(form);\n    };\n}\n\n\nexport default initializeFileUploadControl;\n","import Nette from 'nette-forms';\nimport initializeFileUploadControl from './index';\n\ninitializeFileUploadControl(Nette);\n"],"names":["Button","$fileUpload","buttonSelector","targetSelector","button","find","click","$","get","reverse","toggleClass","length","Buttons","abortButton","deleteButton","refreshState","FilesList","dataAttribute","getInput","data","file","files","list","push","fileUrl","grep","url","FileUpload","name","size","type","each","index","status","progress","deleteUrl","downloadUrl","thumbnailUrl","error","$filesContainer","$file","createUI","updateFileInfoUI","append","fadeIn","hide","Math","max","min","updateFileInfo","$error","html","$done","element","attr","$element","text","formatBytes","floor","css","toFixed","$thumbnail","is","thumbnailAttributes","attributes","idx","attribute","value","replaceWith","bytes","units","unit","i","abs","initializeControl","container","uniqueFilenames","forEach","filename","fileupload","dropZone","pasteZone","dataType","formData","singleFileUploads","maxChunkSize","limitConcurrentUploads","submit","hasClass","prop","filesList","buttons","on","e","isDefaultPrevented","fileUpload","updateProgress","loaded","total","errorThrown","failed","result","done","add","processing","$this","closest","upload","abort","remove","fadeOut","initializeForm","form","initializeFileUploadControl","Nette","document","preventDefault","originalGetEffectiveValue","getEffectiveValue","elem","filter","nodeName","toLowerCase","originalInitForm","initForm"],"mappings":"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"}
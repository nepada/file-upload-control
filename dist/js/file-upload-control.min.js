!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("nette-forms"),require("jquery"),require("blueimp-file-upload")):"function"==typeof define&&define.amd?define(["nette-forms","jquery","blueimp-file-upload"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Nette,e.jQuery)}(this,(function(e,t){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=i(e),l=i(t);function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function r(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}var f=function(){function e(t,i,a){var o=this;n(this,e),this.$fileUpload=t,this.button=t.find(i),this.targetSelector=a,this.button.click((function(){l.default(o.$fileUpload.find(o.targetSelector).get().reverse()).click()}))}return r(e,[{key:"refreshState",value:function(){this.button.toggleClass("disabled",0===this.$fileUpload.find(this.targetSelector).length)}}]),e}(),u=function(){function e(t){n(this,e),this.abortButton=new f(t,"[data-file-upload-role=abort]","[data-file-upload-status=processing] [data-file-upload-role=file-delete]"),this.deleteButton=new f(t,"[data-file-upload-role=delete]","[data-file-upload-role=file-delete]")}return r(e,[{key:"refreshState",value:function(){this.abortButton.refreshState(),this.deleteButton.refreshState()}}]),e}(),d=function(){function e(t){n(this,e),this.$fileUpload=t,this.dataAttribute="files"}return r(e,[{key:"getInput",value:function(){return this.$fileUpload.find("input[type=file]")}},{key:"list",value:function(){return this.getInput().data(this.dataAttribute)||[]}},{key:"add",value:function(e){var t=this.list();t.push(e),this.getInput().data(this.dataAttribute,t)}},{key:"remove",value:function(e){this.getInput().data(this.dataAttribute,l.default.grep(this.list(),(function(t){return t.url!==e})))}}]),e}(),s=function(){function e(t,i){n(this,e);var a="",o=0,r="";l.default.each(i,(function(e,t){a=a+(e?", ":"")+t.name,o+=t.size,(r=r||t.type)!==t.type&&(r=r+", "+t.type)})),this.name=a,this.size=o,this.type=r,this.status="processing",this.progress=0,this.deleteUrl=null,this.downloadUrl=null,this.thumbnailUrl=null,this.error=null,this.$filesContainer=t.find("[data-file-upload-role=files]"),this.$file=this.createUI(),this.updateFileInfoUI(),this.$filesContainer.append(this.$file),this.$file.fadeIn()}return r(e,[{key:"createUI",value:function(){var e=l.default(this.$filesContainer.data("templateFile"));return e.find("[data-file-upload-role=file-status]").append(l.default(this.$filesContainer.data("templateProcessing"))),e.hide(),e}},{key:"updateProgress",value:function(e){this.progress=100*Math.max(0,Math.min(e,1)),this.updateFileInfoUI()}},{key:"updateFileInfo",value:function(e){this.downloadUrl=e.url||this.downloadUrl,this.thumbnailUrl=e.thumbnailUrl||this.thumbnailUrl,this.deleteUrl=e.deleteUrl||this.deleteUrl,this.type=e.type||this.type}},{key:"processing",value:function(e){this.updateFileInfo(e),this.updateFileInfoUI()}},{key:"failed",value:function(e){this.status="failed",e&&e.error&&(this.error=e.error);var t=l.default(this.$filesContainer.data("templateFailed"));this.updateFileInfoUI(t),this.$file.find("[data-file-upload-role=file-status]").html(t),this.updateFileInfoUI()}},{key:"done",value:function(e){this.status="done",this.updateFileInfo(e);var t=l.default(this.$filesContainer.data("templateDone"));this.updateFileInfoUI(t),this.$file.find("[data-file-upload-role=file-status]").html(t),this.updateFileInfoUI()}},{key:"updateFileInfoUI",value:function(e){this.$file.attr("data-file-upload-status",this.status),this.$file.attr("data-content-type",this.type),this.$file.attr("title",this.name);var t=l.default(e||this.$file);if(t.find("[data-file-upload-role=file-name]").text(this.name),t.find("[data-file-upload-role=file-size]").text(this.formatBytes(this.size)),t.find("[data-file-upload-role=file-progress-bar]").attr("aria-valuenow",Math.floor(this.progress)).css("width",this.progress.toFixed(2)+"%"),this.error&&t.find("[data-file-upload-role=file-error]").text(this.error),this.deleteUrl&&t.find("[data-file-upload-role=file-delete]").attr("data-url",this.deleteUrl),this.downloadUrl&&t.find("[data-file-upload-role=file-download]").attr("href",this.downloadUrl),this.thumbnailUrl){var i=t.find("[data-file-upload-role=file-thumbnail]");if(i.is("img"))i.attr("src",this.thumbnailUrl);else if(i.length>0){var a={};l.default.each(i.get(0).attributes,(function(e,t){a[t.name]=t.value})),i.replaceWith(l.default("<img>").attr(a).attr("src",this.thumbnailUrl))}}}},{key:"formatBytes",value:function(e){for(var t,i=["B","kB","MB","GB","TB","PB"],a=0;a<i.length&&(t=i[a],!(Math.abs(e)<1024||a===i.length-1));a++)e/=1024;return e.toFixed(2)+" "+t}}]),e}();function h(e){l.default(e).find("[data-file-upload-url]").each((function(e,t){!function(e){var t=l.default(e);if(!t.data("blueimpFileupload")){var i={};(t.data("uniqueFilenames")||[]).forEach((function(e){i[e]=!0})),t.fileupload({url:t.data("fileUploadUrl"),dropZone:t,pasteZone:null,dataType:"json",formData:[],uniqueFilenames:i,singleFileUploads:!0,maxChunkSize:2097152,limitConcurrentUploads:3,submit:function(){return!t.hasClass("disabled")&&!t.is(":disabled")&&!t.find("input[type=file]").prop("disabled")}});var a=new d(t),n=new u(t);t.on("fileuploadadd",(function(e,i){if(e.isDefaultPrevented())return!1;i.fileUpload=new s(t,i.files),i.fileUpload.$file.data("upload",i),n.refreshState()})).on("fileuploadprogress",(function(e,t){if(e.isDefaultPrevented())return!1;t.fileUpload.updateProgress(t.loaded/t.total)})).on("fileuploadfail",(function(e,t){t.fileUpload&&"abort"!==t.errorThrown&&(t.fileUpload.failed(),n.refreshState())})).on("fileuploaddone",(function(e,t){var i=t.result.files[0];i.error?t.fileUpload.failed(i):(t.fileUpload.done(i),a.add(i)),n.refreshState()})).on("fileuploadchunkdone",(function(e,t){var i=t.result.files[0];i.error?(t.fileUpload.failed(i),n.refreshState()):t.fileUpload.processing(i)})).on("fileuploadchunksend",(function(e,t){return!t.fileUpload||"failed"!==t.fileUpload.status})).on("click","[data-file-upload-role=file-delete]",(function(){var e=l.default(this),t=e.closest("[data-file-upload-role=file]"),i=t.data("upload");i&&i.abort(),e.is("[data-url]")&&l.default.get(e.data("url"));var o=t.find("[data-file-upload-role=file-download]").attr("href");a.remove(o),t.fadeOut((function(){t.remove(),n.refreshState()}))}))}}(t)}))}!function(e){l.default(document).on("drop dragover",(function(e){e.preventDefault()}));var t=e.getEffectiveValue;e.getEffectiveValue=function(e,i){return e&&e.nodeName&&"input"===e.nodeName.toLowerCase()&&l.default(e).data("files")?l.default(e).data("files"):t(e,i)},l.default((function(){l.default("form").each((function(e,t){h(t)}))}));var i=e.initForm;e.initForm=function(e){i(e),h(e)}}(a.default)}));
//# sourceMappingURL=file-upload-control.min.js.map

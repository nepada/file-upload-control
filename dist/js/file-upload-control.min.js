!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("nette-forms"),require("jquery"),require("blueimp-file-upload")):"function"==typeof define&&define.amd?define(["nette-forms","jquery","blueimp-file-upload"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Nette,e.jQuery)}(this,(function(e,t){"use strict";class i{constructor(e,i,l){this.$fileUpload=e,this.button=e.find(i),this.targetSelector=l,this.button.click((()=>{t(this.$fileUpload.find(this.targetSelector).get().reverse()).click()}))}refreshState(){this.button.toggleClass("disabled",0===this.$fileUpload.find(this.targetSelector).length)}}class l{constructor(e){this.abortButton=new i(e,"[data-file-upload-role=abort]","[data-file-upload-status=processing] [data-file-upload-role=file-delete]"),this.deleteButton=new i(e,"[data-file-upload-role=delete]","[data-file-upload-role=file-delete]")}refreshState(){this.abortButton.refreshState(),this.deleteButton.refreshState()}}class a{constructor(e){this.$fileUpload=e,this.dataAttribute="files"}getInput(){return this.$fileUpload.find("input[type=file]")}list(){return this.getInput().data(this.dataAttribute)||[]}add(e){var t=this.list();t.push(e),this.getInput().data(this.dataAttribute,t)}remove(e){this.getInput().data(this.dataAttribute,t.grep(this.list(),(t=>t.url!==e)))}removeByDeleteUrl(e){this.getInput().data(this.dataAttribute,t.grep(this.list(),(t=>t.deleteUrl!==e)))}removeByUid(e){this.getInput().data(this.dataAttribute,t.grep(this.list(),(t=>t.uid!==e)))}}class s{constructor(e,i){var l="",s=0,r="";t.each(i,((e,t)=>{l=l+(e?", ":"")+t.name,s+=t.size,(r=r||t.type)!==t.type&&(r=r+", "+t.type)})),this.name=l,this.size=s,this.type=r,this.status="processing",this.progress=0,this.deleteUrl=null,this.downloadUrl=null,this.thumbnailUrl=null,this.error=null,this.$filesContainer=e.find("[data-file-upload-role=files]"),this.$file=this.createUI();var o=[l,s,Math.floor(Math.random()*2**32)].join("|");this.fileListItem={name:l,size:s,type:r,uid:o},this.fileList=new a(e),this.fileList.add(this.fileListItem),this.updateFileInfoUI(),this.$filesContainer.append(this.$file),this.$file.fadeIn()}createUI(){var e=t(this.$filesContainer.data("templateFile"));return e.find("[data-file-upload-role=file-status]").append(t(this.$filesContainer.data("templateProcessing"))),e.hide(),e}updateProgress(e){this.progress=100*Math.max(0,Math.min(e,1)),this.updateFileInfoUI()}updateFileInfo(e){this.downloadUrl=e.url||this.downloadUrl,this.thumbnailUrl=e.thumbnailUrl||this.thumbnailUrl,this.deleteUrl=e.deleteUrl||this.deleteUrl,this.type=e.type||this.type,this.replaceFileListItem(e)}replaceFileListItem(e){this.fileListItem&&(this.fileList.removeByUid(this.fileListItem.uid),this.fileList.add(e),this.fileListItem=null)}processing(e){this.updateFileInfo(e),this.updateFileInfoUI()}failed(e){this.status="failed",e&&e.error&&(this.error=e.error);var i=t(this.$filesContainer.data("templateFailed"));this.updateFileInfoUI(i),this.$file.find("[data-file-upload-role=file-status]").html(i),this.updateFileInfoUI(),this.removeFileListItem()}aborted(){this.removeFileListItem()}removeFileListItem(){this.fileListItem&&(this.fileList.removeByUid(this.fileListItem.uid),this.fileListItem=null)}done(e){this.status="done",this.updateFileInfo(e);var i=t(this.$filesContainer.data("templateDone"));this.updateFileInfoUI(i),this.$file.find("[data-file-upload-role=file-status]").html(i),this.updateFileInfoUI()}updateFileInfoUI(e){this.$file.attr("data-file-upload-status",this.status),this.$file.attr("data-content-type",this.type),this.$file.attr("title",this.name);var i=t(e||this.$file);if(i.find("[data-file-upload-role=file-name]").text(this.name),i.find("[data-file-upload-role=file-size]").text(this.formatBytes(this.size)),i.find("[data-file-upload-role=file-progress-bar]").attr("aria-valuenow",Math.floor(this.progress)).css("width",this.progress.toFixed(2)+"%"),this.error&&i.find("[data-file-upload-role=file-error]").text(this.error),this.deleteUrl&&i.find("[data-file-upload-role=file-delete]").attr("data-url",this.deleteUrl),this.downloadUrl&&i.find("[data-file-upload-role=file-download]").attr("href",this.downloadUrl),this.thumbnailUrl){var l=i.find("[data-file-upload-role=file-thumbnail]");if(l.is("img"))l.attr("src",this.thumbnailUrl);else if(l.length>0){var a={};t.each(l.get(0).attributes,((e,t)=>{a[t.name]=t.value})),l.replaceWith(t("<img>").attr(a).attr("src",this.thumbnailUrl))}}}formatBytes(e){for(var t,i=["B","kB","MB","GB","TB","PB"],l=0;l<i.length&&(t=i[l],!(Math.abs(e)<1024||l===i.length-1));l++)e/=1024;return e.toFixed(2)+" "+t}}function r(e){t(e).find("[data-file-upload-url]").each(((e,i)=>{!function(e){var i=t(e);if(!i.data("blueimpFileupload")){var r={};(i.data("uniqueFilenames")||[]).forEach((e=>{r[e]=!0})),i.fileupload({url:i.data("fileUploadUrl"),dropZone:i,pasteZone:null,dataType:"json",formData:[],uniqueFilenames:r,singleFileUploads:!0,maxChunkSize:2097152,limitConcurrentUploads:3,submit:()=>!i.hasClass("disabled")&&!i.is(":disabled")&&!i.find("input[type=file]").prop("disabled")});var o=new a(i),d=new l(i);i.on("fileuploadadd",((e,t)=>{if(e.isDefaultPrevented())return!1;t.fileUpload=new s(i,t.files),t.fileUpload.$file.data("upload",t),d.refreshState()})).on("fileuploadprogress",((e,t)=>{if(e.isDefaultPrevented())return!1;t.fileUpload.updateProgress(t.loaded/t.total)})).on("fileuploadfail",((e,t)=>{t.fileUpload&&("abort"===t.errorThrown?t.fileUpload.aborted():(t.fileUpload.failed(),d.refreshState()))})).on("fileuploaddone",((e,t)=>{var i=t.result.files[0];i.error?t.fileUpload.failed(i):t.fileUpload.done(i),d.refreshState()})).on("fileuploadchunkdone",((e,t)=>{var i=t.result.files[0];i.error?(t.fileUpload.failed(i),d.refreshState()):t.fileUpload.processing(i)})).on("fileuploadchunksend",((e,t)=>!t.fileUpload||"failed"!==t.fileUpload.status)).on("click","[data-file-upload-role=file-delete]",(function(){var e=t(this),i=e.closest("[data-file-upload-role=file]"),l=i.data("upload");l&&l.abort();var a=e.data("url");a&&(t.get(a),o.removeByDeleteUrl(a)),i.fadeOut((()=>{i.remove(),d.refreshState()}))}))}}(i)}))}!function(e){t(document).on("drop dragover",(e=>{e.preventDefault()})),e.validators.NepadaFileUploadControlValidationClientSide_noUploadInProgress=e=>0===t(e).closest("[data-file-upload-url]").find("[data-file-upload-status=processing] [data-file-upload-role=file-delete]").length;var i=e.getEffectiveValue;e.getEffectiveValue=(l,a)=>l&&l.nodeName&&"input"===l.nodeName.toLowerCase()&&t(l).data("files")?t(l).data("files"):i.apply(e,[l,a]),t((()=>{t("form").each(((e,t)=>{r(t)}))}));var l=e.initForm;e.initForm=t=>{l.apply(e,[t]),r(t)}}(e)}));
//# sourceMappingURL=file-upload-control.min.js.map

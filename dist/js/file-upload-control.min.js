!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("nette-forms"),require("jquery"),require("blueimp-file-upload")):"function"==typeof define&&define.amd?define(["nette-forms","jquery","blueimp-file-upload"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Nette,e.jQuery)}(this,(function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(l=a.key,n=void 0,"symbol"==typeof(n=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(l,"string"))?n:String(n)),a)}var l,n}function l(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}var n=function(){function e(a,l,n){var r=this;i(this,e),this.$fileUpload=a,this.button=a.find(l),this.targetSelector=n,this.button.click((function(){t(r.$fileUpload.find(r.targetSelector).get().reverse()).click()}))}return l(e,[{key:"refreshState",value:function(){this.button.toggleClass("disabled",0===this.$fileUpload.find(this.targetSelector).length)}}]),e}(),r=function(){function e(t){i(this,e),this.abortButton=new n(t,"[data-file-upload-role=abort]","[data-file-upload-status=processing] [data-file-upload-role=file-delete]"),this.deleteButton=new n(t,"[data-file-upload-role=delete]","[data-file-upload-role=file-delete]")}return l(e,[{key:"refreshState",value:function(){this.abortButton.refreshState(),this.deleteButton.refreshState()}}]),e}(),o=function(){function e(t){i(this,e),this.$fileUpload=t,this.dataAttribute="files"}return l(e,[{key:"getInput",value:function(){return this.$fileUpload.find("input[type=file]")}},{key:"list",value:function(){return this.getInput().data(this.dataAttribute)||[]}},{key:"add",value:function(e){var t=this.list();t.push(e),this.getInput().data(this.dataAttribute,t)}},{key:"remove",value:function(e){this.getInput().data(this.dataAttribute,t.grep(this.list(),(function(t){return t.url!==e})))}}]),e}(),f=function(){function e(a,l){i(this,e);var n="",r=0,o="";t.each(l,(function(e,t){n=n+(e?", ":"")+t.name,r+=t.size,(o=o||t.type)!==t.type&&(o=o+", "+t.type)})),this.name=n,this.size=r,this.type=o,this.status="processing",this.progress=0,this.deleteUrl=null,this.downloadUrl=null,this.thumbnailUrl=null,this.error=null,this.$filesContainer=a.find("[data-file-upload-role=files]"),this.$file=this.createUI(),this.updateFileInfoUI(),this.$filesContainer.append(this.$file),this.$file.fadeIn()}return l(e,[{key:"createUI",value:function(){var e=t(this.$filesContainer.data("templateFile"));return e.find("[data-file-upload-role=file-status]").append(t(this.$filesContainer.data("templateProcessing"))),e.hide(),e}},{key:"updateProgress",value:function(e){this.progress=100*Math.max(0,Math.min(e,1)),this.updateFileInfoUI()}},{key:"updateFileInfo",value:function(e){this.downloadUrl=e.url||this.downloadUrl,this.thumbnailUrl=e.thumbnailUrl||this.thumbnailUrl,this.deleteUrl=e.deleteUrl||this.deleteUrl,this.type=e.type||this.type}},{key:"processing",value:function(e){this.updateFileInfo(e),this.updateFileInfoUI()}},{key:"failed",value:function(e){this.status="failed",e&&e.error&&(this.error=e.error);var i=t(this.$filesContainer.data("templateFailed"));this.updateFileInfoUI(i),this.$file.find("[data-file-upload-role=file-status]").html(i),this.updateFileInfoUI()}},{key:"done",value:function(e){this.status="done",this.updateFileInfo(e);var i=t(this.$filesContainer.data("templateDone"));this.updateFileInfoUI(i),this.$file.find("[data-file-upload-role=file-status]").html(i),this.updateFileInfoUI()}},{key:"updateFileInfoUI",value:function(e){this.$file.attr("data-file-upload-status",this.status),this.$file.attr("data-content-type",this.type),this.$file.attr("title",this.name);var i=t(e||this.$file);if(i.find("[data-file-upload-role=file-name]").text(this.name),i.find("[data-file-upload-role=file-size]").text(this.formatBytes(this.size)),i.find("[data-file-upload-role=file-progress-bar]").attr("aria-valuenow",Math.floor(this.progress)).css("width",this.progress.toFixed(2)+"%"),this.error&&i.find("[data-file-upload-role=file-error]").text(this.error),this.deleteUrl&&i.find("[data-file-upload-role=file-delete]").attr("data-url",this.deleteUrl),this.downloadUrl&&i.find("[data-file-upload-role=file-download]").attr("href",this.downloadUrl),this.thumbnailUrl){var a=i.find("[data-file-upload-role=file-thumbnail]");if(a.is("img"))a.attr("src",this.thumbnailUrl);else if(a.length>0){var l={};t.each(a.get(0).attributes,(function(e,t){l[t.name]=t.value})),a.replaceWith(t("<img>").attr(l).attr("src",this.thumbnailUrl))}}}},{key:"formatBytes",value:function(e){for(var t,i=["B","kB","MB","GB","TB","PB"],a=0;a<i.length&&(t=i[a],!(Math.abs(e)<1024||a===i.length-1));a++)e/=1024;return e.toFixed(2)+" "+t}}]),e}();function u(e){t(e).find("[data-file-upload-url]").each((function(e,i){!function(e){var i=t(e);if(!i.data("blueimpFileupload")){var a={};(i.data("uniqueFilenames")||[]).forEach((function(e){a[e]=!0})),i.fileupload({url:i.data("fileUploadUrl"),dropZone:i,pasteZone:null,dataType:"json",formData:[],uniqueFilenames:a,singleFileUploads:!0,maxChunkSize:2097152,limitConcurrentUploads:3,submit:function(){return!i.hasClass("disabled")&&!i.is(":disabled")&&!i.find("input[type=file]").prop("disabled")}});var l=new o(i),n=new r(i);i.on("fileuploadadd",(function(e,t){if(e.isDefaultPrevented())return!1;t.fileUpload=new f(i,t.files),t.fileUpload.$file.data("upload",t),n.refreshState()})).on("fileuploadprogress",(function(e,t){if(e.isDefaultPrevented())return!1;t.fileUpload.updateProgress(t.loaded/t.total)})).on("fileuploadfail",(function(e,t){t.fileUpload&&"abort"!==t.errorThrown&&(t.fileUpload.failed(),n.refreshState())})).on("fileuploaddone",(function(e,t){var i=t.result.files[0];i.error?t.fileUpload.failed(i):(t.fileUpload.done(i),l.add(i)),n.refreshState()})).on("fileuploadchunkdone",(function(e,t){var i=t.result.files[0];i.error?(t.fileUpload.failed(i),n.refreshState()):t.fileUpload.processing(i)})).on("fileuploadchunksend",(function(e,t){return!t.fileUpload||"failed"!==t.fileUpload.status})).on("click","[data-file-upload-role=file-delete]",(function(){var e=t(this),i=e.closest("[data-file-upload-role=file]"),a=i.data("upload");a&&a.abort(),e.is("[data-url]")&&t.get(e.data("url"));var r=i.find("[data-file-upload-role=file-download]").attr("href");l.remove(r),i.fadeOut((function(){i.remove(),n.refreshState()}))}))}}(i)}))}!function(e){t(document).on("drop dragover",(function(e){e.preventDefault()}));var i=e.getEffectiveValue;e.getEffectiveValue=function(e,a){return e&&e.nodeName&&"input"===e.nodeName.toLowerCase()&&t(e).data("files")?t(e).data("files"):i(e,a)},t((function(){t("form").each((function(e,t){u(t)}))}));var a=e.initForm;e.initForm=function(e){a(e),u(e)}}(e)}));
//# sourceMappingURL=file-upload-control.min.js.map
